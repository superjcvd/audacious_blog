{{ define "main" }}

{{- $name := .Params.Name | default "Name not provided" }}
{{- $jobTitle := .Params.JobTitle | default "" }}
{{- $introduction := .Params.Introduction | default "" }}
{{- $photo := .Params.Photo | default "" }}
{{- $contact := .Params.Contact | default slice }}
{{- $profile := .Params.Profile | default slice }}
{{- $skills := .Params.Skills | default dict }}
{{- $experience := .Params.Experience | default slice }}
{{- $education := .Params.Education | default slice }}
{{- $interests := .Params.Interests | default slice }}
{{- $image := "" }}
{{- if $photo }}
{{- $image = resources.Get $photo }}
{{- end }}

{{- if or (not $name) (eq $name "Name not provided") }}
<div class="alert alert-warning">Resume data not found. Please check your front matter.</div>
{{- else }}

<div class="row">

  <!-- Name and title -->
  <div class="pb-4">
    <h1 class="text-title mb-3">{{ $name }}</h1>
    {{- if $jobTitle }}
    <p class="lead">{{ $jobTitle }}</p>
    {{- end }}
    {{- if $introduction }}
    <p class="text">{{ $introduction | replaceRE "\n" "<br>" | safeHTML }}</p>
    {{- end }}
  </div>

  <div class="col-lg-8 col-md-12 order-2 order-lg-1">
    <!-- Profile -->
    {{- if $profile }}
    <div class="pb-4">
      <h3 class="text-title">Profile</h3>
      <div class="border-top pb-2"></div>
      <div>
        {{ range $profile }}
        {{ . }}<br>
        {{ end }}
      </div>
    </div>
    {{- end }}

    <!-- Experience -->
    {{- if $experience }}
    <div class="pb-4">
      <h3 class="text-title">Experience</h3>
      <div class="border-top pb-2"></div>
      <div>
        {{ range $experience }}
        <div class="mb-4">
          <h5 class="text-subtitle">{{ .Employer }} - {{ .City }}</h5>
          <h6 class="text-info">{{ .Date }}</h6>
          <h6><strong>{{ .Position }}</strong></h6>
          {{- if .Detail }}
          <ul class="mt-2 mb-0">
            {{- $details := split .Detail "\n" }}
            {{- range $details }}
            {{- $trimmed := trim . " \t\r\n" }}
            {{- if $trimmed }}
            <li>{{ $trimmed }}</li>
            {{- end }}
            {{- end }}
          </ul>
          {{- end }}
        </div>
        {{ end }}
      </div>
    </div>
    {{- end }}

    <!-- New page break for PDF export -->
    <!-- <div class="pagebreak"></div> -->

    <!-- Education -->
    {{- if $education }}
    <div class="pb-4">
      <h3 class="text-title">Education</h3>
      <div class="border-top pb-2"></div>
      <div class="row">
        {{ range $education }}
        <div class="col-md-6 mb-3">
          <h5 class="text-subtitle pt-3">{{ .Place }}</h5>
          <h6 class="text-info">{{ .Date }}</h6>
          <h6>{{ .Course }}</h6>
        </div>
        {{ end }}
      </div>
    </div>
    {{- end }}

    <!-- Interests -->
    {{- if $interests }}
    <div class="">
      <h3 class="text-title pt-4">Interests</h3>
      <div class="border-top pb-2"></div>
      <div>
        {{ range $interests }}
        <div class="mb-2">
          <i class="fa-solid fa-{{ .Icon }} text-subtitle me-2"></i>
          <span>{{ .Name }}</span>
        </div>
        {{ end }}
      </div>
    </div>
    {{- end }}
  </div>

  <!-- Contact -->
  <div class="col-lg-4 col-md-12 order-1 order-lg-2">
    {{- if $image }}
    <div class="py-3">
      <img class="img-responsive rounded img-fluid" src="{{ $image.RelPermalink }}"
        style="max-width: 256px; width: 100%;" alt="{{ $name }} photo">
    </div>
    {{- end }}
    {{- if $contact }}
    <div class="">
      {{ range $contact }}
      <div class="mb-2">
        <i class="fa-solid fa-{{ .Icon }} text-subtitle me-2"></i>
        <span class="text-subtitle">{{ .Key }}: </span>
        {{ if eq .Key "LinkedIn" }}
        <a href="{{ .Value }}" target="_blank" rel="noopener noreferrer">{{ .DisplayLink }}</a>
        {{ else if eq .Key "Email" }}
        <a href="mailto:{{ .Value }}">{{ .Value }}</a>
        {{ else }}
        <span>{{ .Value }}</span>
        {{ end }}
      </div>
      {{ end }}
    </div>
    {{- end }}

    {{- if $skills }}
    <div class="">
      <h3 class="text-title pt-5">Skills</h3>
      <div class="border-top pb-2"></div>
      {{ range $key, $value := $skills }}
      <h5 class="text-subtitle pt-4 pb-2">{{ $key | title }}</h5>
      {{ range $value }}
      <div class="btn btn-primary bg-gradient btn-sm my-1">{{ . }}</div>
      {{ end }}
      {{ end }}
    </div>
    {{- end }}
  </div>

</div>
{{- end }}
{{ end }}